#!/bin/bash

source cargo-cross-env

if [[ -z "$CARGO_WRAPPER_TARGET_DIR" && -n "$CARGO_TARGET_DIR" ]]; then
    export CARGO_WRAPPER_TARGET_DIR="$CARGO_TARGET_DIR"
fi
if [[ -z "$CARGO_WRAPPER_SCCACHE_DIR" && -n "$SCCACHE_DIR" ]]; then
    export CARGO_WRAPPER_SCCACHE_DIR="$SCCACHE_DIR"
fi

PATH=$(echo $PATH | tr : "\n" | grep -v /cargo-wrapper/ | tr "\n" :)
export PATH="${PATH%:}"

if [[ -n "$ACTIONS_RUNNER_DEBUG" || -n "$DEBUG" ]]; then
    echo 'Environment:'
    env
fi

cargo "${@:1}"
